<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Sınav Oluşturucu - Mersin Etkin Zümre</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link rel="preload" as="image" href="EZKLogo.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@1,600&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Times+New+Roman&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- MASTER CSS (TÜM SAYFALARDA AYNI) --- */
        :root { --meb-red: #E30A17; --corporate-dark: #0F172A; --bg-light: #f8fafc; --text-gray: #333; }
        html { overflow-y: scroll; height: 100%; } 
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-light); color: var(--text-gray); overflow-x: hidden; height: 100%; }
        a { text-decoration: none; color: inherit; transition: 0.3s; }
        ul { list-style: none; }
        .container { width: 94%; max-width: 1400px; margin: 0 auto; }

        /* HEADER (100px Yükseklik) */
        .top-header { background: white; padding: 10px 0; border-bottom: 1px solid #e2e8f0; height: 100px; display: flex; align-items: center; }
        .top-content { display: flex; justify-content: space-between; align-items: center; height: 100%; width: 100%; }
        .brand-area { display: flex; align-items: center; gap: 5px; height: 80px; flex-shrink: 0; }
        
        /* LOGO KUTUSU (80px) */
        .logo-fixed { width: 80px; height: 80px; background-image: url('EZKLogo.png'); background-size: contain; background-repeat: no-repeat; background-position: center left; flex-shrink: 0; display: block; }
        
        .brand-text { display: flex; flex-direction: column; justify-content: center; line-height: 1.1; overflow: hidden; }
        .brand-text h1 { font-size: 1.6rem; font-weight: 900; color: var(--corporate-dark); text-transform: uppercase; letter-spacing: -0.5px; margin: 0; white-space: nowrap; }
        .brand-text span { font-size: 0.9rem; color: #64748b; font-weight: 600; margin-top: 2px; }
        
        .slogan-area { text-align: right; min-width: 200px; }
        .slogan-text { font-family: 'Playfair Display', serif; font-size: 1.3rem; font-style: italic; color: var(--meb-red); font-weight: 600; }

        /* NAVİGASYON */
        .main-nav { background-color: var(--corporate-dark); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); position: sticky; top: 0; z-index: 1000; border-top: 4px solid var(--meb-red); height: 60px; }
        .nav-container { width: 94%; max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; height: 100%; }
        .desktop-nav { display: flex; height: 100%; align-items: center; }
        .nav-item { height: 100%; position: relative; display: flex; align-items: center; }
        .nav-link { color: rgba(255, 255, 255, 0.9); font-weight: 600; font-size: 0.9rem; padding: 0 22px; height: 100%; display: flex; align-items: center; border-right: 1px solid rgba(255, 255, 255, 0.06); text-transform: uppercase; letter-spacing: 0.5px; }
        .nav-link:hover, .nav-item:hover .nav-link, .nav-item.active .nav-link { background-color: var(--meb-red); color: white; }
        .nav-link i { margin-left: 6px; font-size: 0.75rem; opacity: 0.8; }
        
        /* Dropdown */
        .dropdown-menu { display: none; position: absolute; top: 100%; left: 0; background-color: white; min-width: 250px; box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); border-top: 3px solid var(--meb-red); padding: 5px 0; z-index: 9999; }
        .nav-item:hover .dropdown-menu { display: block; animation: fadeIn 0.2s ease; }
        .dropdown-item a { display: flex; align-items: center; padding: 12px 20px; color: #333; font-size: 0.9rem; font-weight: 500; border-bottom: 1px solid #f1f5f9; }
        .dropdown-item a i { margin-right: 10px; color: #64748b; width: 20px; text-align: center; }
        .dropdown-item a:hover { background-color: #f8fafc; color: var(--meb-red); padding-left: 25px; }
        .dropdown-item a:hover i { color: var(--meb-red); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hamburger { display: none; font-size: 1.5rem; color: white; cursor: pointer; padding: 10px; }

        /* MOBİL MENÜ */
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 2000; opacity: 0; visibility: hidden; transition: 0.3s; }
        .sidebar-menu { position: fixed; top: 0; left: -320px; width: 300px; height: 100%; background-color: var(--corporate-dark); z-index: 2001; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 5px 0 15px rgba(0, 0, 0, 0.3); display: flex; flex-direction: column; }
        body.menu-open .sidebar-overlay { opacity: 1; visibility: visible; } body.menu-open .sidebar-menu { left: 0; }
        .sidebar-header { padding: 25px 20px; background: #0b1120; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); } .sidebar-brand { font-weight: 800; color: white; font-size: 1.2rem; } .close-btn { color: #cbd5e1; font-size: 1.5rem; cursor: pointer; }
        .sidebar-list { padding: 10px 0; } .sidebar-link { display: block; padding: 14px 20px; color: #cbd5e1; font-weight: 500; border-bottom: 1px solid rgba(255,255,255,0.03); } .sidebar-link:hover { background: rgba(255,255,255,0.05); color: var(--meb-red); padding-left: 28px; } .sidebar-link.active { color: var(--meb-red); background: rgba(227,10,23,0.1); border-left: 4px solid var(--meb-red); }

        @media screen and (max-width: 1100px) {
            .top-header { height: auto; padding: 10px 0; }
            .top-content { flex-direction: row; justify-content: space-between; align-items: center; padding: 10px 5px; height: auto; }
            .brand-area { flex-direction: row !important; align-items: center; gap: 12px; text-align: left; width: auto; height: auto; }
            .logo-fixed { width: 60px; height: 60px; }
            .brand-text h1 { font-size: 1.1rem; text-align: left; margin: 0; } .brand-text span { font-size: 0.75rem; text-align: left; display: block; }
            .slogan-area { display: none; }
            .desktop-nav { display: none; } .hamburger { display: block; margin-left: auto; color: white; }
        }

        /* --- EDİTÖR ÖZEL STİLLERİ --- */
        .editor-layout { display: flex; gap: 30px; padding: 40px 0; min-height: calc(100vh - 160px); }
        
        .input-panel { flex: 0 0 450px; background: white; padding: 25px; border-radius: 12px; border: 1px solid #e2e8f0; height: fit-content; position: sticky; top: 80px; }
        .section-title { font-size: 1rem; font-weight: 700; color: var(--meb-red); border-bottom: 2px solid #e2e8f0; padding-bottom: 5px; margin: 20px 0 10px 0; text-transform: uppercase; }
        
        label { display: block; margin-top: 15px; font-size: 0.85rem; font-weight: 600; color: #64748b; }
        input, select, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #cbd5e1; border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 0.9rem; transition: 0.2s; }
        input:focus, select:focus, textarea:focus { border-color: var(--meb-red); outline: none; box-shadow: 0 0 0 3px rgba(227, 10, 23, 0.1); }
        
        /* Kazanım Listesi */
        .kazanim-list { display: flex; flex-direction: column; gap: 5px; margin-top: 10px; }
        .btn-kazanim { text-align: left; background: white; border: 1px solid #cbd5e1; padding: 10px; font-size: 0.85rem; border-radius: 6px; cursor: pointer; transition: 0.2s; color: #334155; line-height: 1.4; }
        .btn-kazanim:hover { border-color: var(--meb-red); color: var(--meb-red); background: #fef2f2; }
        .btn-kazanim i { float: right; color: var(--meb-red); margin-left: 5px; }

        .btn-add { background-color: #22c55e; color: white; width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 15px; transition: 0.2s; }
        .btn-add:hover { background-color: #16a34a; }
        
        .mini-list { list-style: none; padding: 0; margin: 10px 0; }
        .mini-item { background: white; border: 1px solid #e2e8f0; padding: 10px; margin-bottom: 5px; font-size: 0.85rem; display: flex; justify-content: space-between; align-items: center; border-radius: 6px; }
        .btn-del { color: #ef4444; cursor: pointer; padding: 5px; }

        /* İndirme Butonları */
        .action-buttons { display: flex; gap: 10px; margin-top: 30px; }
        .btn-print { background-color: var(--corporate-dark); color: white; flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-print:hover { background-color: var(--meb-red); }
        
        .btn-word { background-color: #2563eb; color: white; flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-word:hover { background-color: #1d4ed8; }

        /* Sağ Panel (Önizleme) */
        .preview-panel { flex: 1; background: #cbd5e1; padding: 40px; border-radius: 12px; display: flex; justify-content: center; overflow-y: auto; }
        
        /* A4 Kağıt Tasarımı */
        .a4-page { 
            width: 210mm; 
            min-height: 297mm; 
            background: white; 
            padding: 15mm; 
            font-family: 'Times New Roman', serif; 
            color: black; 
            font-size: 12pt; 
            line-height: 1.4;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
            position: relative;
        }

        table { border-collapse: collapse; width: 100%; }
        
        .simple-header { text-align: center; margin-bottom: 30px; }
        .simple-header h3, .simple-header h4, .simple-header p { margin: 5px 0; font-weight: bold; text-transform: uppercase; font-size: 12pt; }
        .simple-header h2 { margin: 10px 0; font-size: 14pt; font-weight: bold; text-transform: uppercase; }

        .student-row td { border-bottom: 2px solid #000; padding-bottom: 5px; font-weight: bold; padding-top: 15px; font-size: 12pt; }

        .kazanim-box { border: 1px solid black; padding: 4px 8px; font-style: italic; font-weight: bold; font-size: 11pt; margin-bottom: 8px; background: white; display: inline-block; width: 100%; }
        
        @media screen and (max-width: 1000px) {
            .editor-layout { flex-direction: column; }
            .input-panel { position: static; width: 100%; }
            .preview-panel { padding: 10px; background: white; }
            .a4-page { width: 100%; height: auto; min-height: 297mm; box-shadow: none; padding: 10px; }
        }

        /* YAZDIRMA AYARLARI */
        @media print { 
            @page { size: A4; margin: 10mm; } 
            .top-header, .main-nav, .input-panel, .action-buttons, .hamburger { display: none !important; } 
            body, .container, .editor-layout, .preview-panel { background: white; margin: 0; padding: 0; width: 100%; display: block; }
            .a4-page { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 15mm; box-shadow: none; border: none; } 
        }
    </style>
</head>
<body>

    <div class="top-header">
        <div class="container top-content">
            <div class="brand-area">
                <a href="index.html" class="logo-fixed" title="Anasayfa"></a>
                <div class="brand-text">
                    <h1>MERSİN ETKİN ZÜMRE</h1>
                    <span>Eğitimde Birlik ve İlerleme Platformu</span>
                </div>
            </div>
            <div class="slogan-area">
                <span class="slogan-text">"Köklerden Geleceğe..."</span>
            </div>
        </div>
    </div>

    <nav class="main-nav">
        <div class="container nav-container">
            <ul class="desktop-nav">
                <li class="nav-item"><a href="index.html" class="nav-link">ANASAYFA</a></li>
                <li class="nav-item"><a href="arsiv.html" class="nav-link">ZÜMRE ARŞİVİ</a></li>
                <li class="nav-item"><a href="yonetmelik.html" class="nav-link">YÖNETMELİK</a></li>
                <li class="nav-item">
                    <a href="tutanak.html" class="nav-link" style="background-color:#E30A17;">EVRAK OLUŞTUR <i class="fas fa-chevron-down"></i></a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-item"><a href="doc-zumre.html"><i class="fas fa-users"></i> Zümre Tutanağı</a></li>
                        <li class="dropdown-item"><a href="doc-plan.html"><i class="fas fa-calendar-alt"></i> Yıllık Plan</a></li>
                        <li class="dropdown-item"><a href="doc-sinav.html"><i class="fas fa-file-alt"></i> Yazılı Sınav</a></li>
                        <li class="dropdown-item"><a href="doc-olcme.html"><i class="fas fa-tasks"></i> Ölçme Değerlendirme</a></li>
                        <li class="dropdown-item"><a href="doc-kulup.html"><i class="fas fa-hands-helping"></i> Kulüp Evrakları</a></li>
                        <li class="dropdown-item"><a href="doc-sinif.html"><i class="fas fa-chalkboard-teacher"></i> Sınıf Rehberlik</a></li>
                    </ul>
                </li>
                <li class="nav-item"><a href="maarif.html" class="nav-link">MAARİFİ ANLAMAK</a></li>
                <li class="nav-item"><a href="ilceler.html" class="nav-link">İLÇE ZİYARETLERİ</a></li>
                <li class="nav-item"><a href="ornekler.html" class="nav-link">İYİ ÖRNEKLER</a></li>
                <li class="nav-item"><a href="forum.html" class="nav-link">FORUM</a></li>
            </ul>
            <div class="hamburger" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
        </div>
    </nav>

    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar-menu">
        <div class="sidebar-header"><span class="sidebar-brand">MENÜ</span><div class="close-btn" onclick="toggleSidebar()"><i class="fas fa-times"></i></div></div>
        <ul class="sidebar-list">
            <li><a href="index.html" class="sidebar-link">ANASAYFA</a></li>
            <li><a href="arsiv.html" class="sidebar-link">ZÜMRE ARŞİVİ</a></li>
            <li><a href="yonetmelik.html" class="sidebar-link">YÖNETMELİK</a></li>
            <li><a href="tutanak.html" class="sidebar-link active">EVRAK OLUŞTUR</a></li>
            <li><a href="maarif.html" class="sidebar-link">MAARİFİ ANLAMAK</a></li>
            <li><a href="ilceler.html" class="sidebar-link">İLÇE ZİYARETLERİ</a></li>
            <li><a href="ornekler.html" class="sidebar-link">İYİ ÖRNEKLER</a></li>
            <li><a href="forum.html" class="sidebar-link">FORUM</a></li>
        </ul>
    </div>

    <div class="container editor-layout">
        
        <div class="input-panel">
            
            <div class="section-title" style="margin-top:0;">1. Senaryo Sihirbazı</div>
            <div class="scenario-selector">
                <div class="select-group">
                    <label>Sınıf</label>
                    <select id="selGrade" onchange="loadLessons()">
                        <option value="">Seçiniz...</option>
                        <optgroup label="Ortaokul">
                            <option value="5">5. Sınıf</option>
                            <option value="6">6. Sınıf</option>
                            <option value="7">7. Sınıf</option>
                            <option value="8">8. Sınıf</option>
                        </optgroup>
                        <optgroup label="Lise">
                            <option value="9">9. Sınıf</option>
                            <option value="10">10. Sınıf</option>
                            <option value="11">11. Sınıf</option>
                            <option value="12">12. Sınıf</option>
                        </optgroup>
                    </select>
                </div>
                <div class="select-group"><label>Ders</label><select id="selLesson" onchange="loadScenarios()" disabled><option value="">Önce sınıf seçin</option></select></div>
                <div class="select-group"><label>Senaryo</label><select id="selScenario" onchange="applyScenario()" disabled><option value="">Önce ders seçin</option></select></div>
            </div>

            <div id="kazanimContainer" style="display:none; margin-top:15px;">
                <label style="color:var(--meb-red);">Bu senaryodaki kazanımlar (Ekle'ye bas):</label>
                <div class="kazanim-list" id="kazanimList"></div>
            </div>

            <div class="section-title">2. Başlık ve Ayarlar</div>
            <label>Sayfa Düzeni</label>
            <select id="inpLayout" onchange="renderQuestions()">
                <option value="1">Tek Sütun (Klasik)</option>
                <option value="2">İki Sütun (Tasarruflu)</option>
            </select>

            <input type="text" id="inpExamName" placeholder="Sınav Adı (1. DÖNEM 1. YAZILI SINAVI)" oninput="updateHeader()">
            <input type="text" id="inpLesson" placeholder="Ders Adı" oninput="updateHeader()">
            <input type="text" id="inpSchool" placeholder="Okul Adı (İsteğe Bağlı)" oninput="updateHeader()">

            <div class="section-title">3. Soru Ekleme</div>
            <div style="background:#f8fafc; padding:15px; border:2px dashed #cbd5e1; border-radius:8px; margin-top:10px;">
                <label style="margin-top:0;">Kazanım (Kutu İçi)</label>
                <textarea id="inpKazanim" placeholder="Yukarıdan seçince otomatik dolar..." style="height:50px; font-style:italic; font-family:'Times New Roman';"></textarea>
                <label>Soru Metni</label>
                <textarea id="newQ" placeholder="Soruyu buraya yazınız..." style="height:80px; font-family:'Times New Roman';"></textarea>
                <label>Görsel (Opsiyonel)</label>
                <input type="file" id="inpImg" accept="image/*" style="background:white;">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="text" id="newP" placeholder="Puan (10)">
                    <input type="number" id="spaceSize" placeholder="Boşluk (px)" value="100">
                </div>
                <button class="btn-add" onclick="addQuestion()">+ Soruyu Ekle</button>
            </div>
            <ul id="miniList" class="mini-list"></ul>

            <div class="section-title">4. Alt Bilgi</div>
            <input type="text" id="inpTeacher" placeholder="Ad Soyad" oninput="updateHeader()">
            <input type="text" id="inpTitle" placeholder="Ünvan (Ders Öğretmeni)" oninput="updateHeader()">
            
            <div class="action-buttons">
                <button class="btn-print" onclick="window.print()"><i class="fas fa-print"></i> Yazdır / PDF</button>
                <button class="btn-word" onclick="exportToWord()"><i class="fas fa-file-word"></i> Word İndir</button>
            </div>
        </div>

        <div class="preview-panel">
            <div class="a4-page" id="printArea">
                
                <div class="simple-header">
                    <h2 id="outSchool">OKUL ADI</h2>
                    <h2 id="outTerm">2024-2025 EĞİTİM ÖĞRETİM YILI</h2>
                    <h2 id="outLesson">DERS ADI</h2>
                    <p id="outExamNo">1. DÖNEM 1. YAZILI SINAVI</p>
                </div>

                <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
                    <tr class="student-row">
                        <td style="width:50%;">Adı ve Soyadı:</td>
                        <td style="width:25%;">Sınıfı:</td>
                        <td style="width:25%;">Numarası:</td>
                    </tr>
                </table>

                <div id="questionsContainer"></div>

                <div style="text-align:center; margin-top:30px;">
                    <p style="font-weight:bold;">BAŞARILAR DİLERİM</p>
                    <br>
                    <table style="width:100%">
                        <tr>
                            <td style="width:60%"></td>
                            <td style="text-align:center;">
                                <span id="outTeacher" style="display:block; font-weight:bold;">...</span>
                                <span id="outTitle">Ders Öğretmeni</span>
                            </td>
                        </tr>
                    </table>
                </div>

            </div>
        </div>
    </div>

    <script>
        function toggleSidebar() { document.body.classList.toggle("menu-open"); }

        function exportToWord() {
            var header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Sınav</title><style>body{font-family:'Times New Roman'; font-size:12pt;} .kazanim-box{border:1px solid black; padding:5px; font-weight:bold; font-style:italic; display:block; background:#eee; margin-bottom:10px;}</style></head><body>";
            var footer = "</body></html>";
            var sourceHTML = header + document.getElementById("printArea").innerHTML + footer;
            var source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
            var fileDownload = document.createElement("a");
            document.body.appendChild(fileDownload);
            fileDownload.href = source;
            fileDownload.download = 'sinav.doc';
            fileDownload.click();
            document.body.removeChild(fileDownload);
        }

        // --- VERİTABANI (Kazanım Listesi) ---
        const database = {
            "5": {
                "Türkçe": {
                    "1. Dönem 1. Yazılı - Senaryo 1": ["T.O.5.5. Metinde geçen anlamını bilmediği söz varlığı... (2 Soru)", "T.O.5.6. Metnin yüzey anlamı... (1 Soru)", "T.O.5.21. Söz varlığını geliştirme... (1 Soru)", "T.Y.5.18. Yazısını zenginleştirme... (1 Soru)", "T.Y.5.21. Yazım ve noktalama... (1 Soru)"],
                    "1. Dönem 1. Yazılı - Senaryo 2": ["T.O.5.5. Söz varlığı tahmini... (1 Soru)", "T.O.5.6. Yüzey anlamı belirleme... (1 Soru)", "T.Y.5.18. Yazı zenginleştirme... (1 Soru)", "T.Y.5.21. Yazım ve noktalama... (1 Soru)"]
                }
            },
            "7": {
                "Matematik": {
                    "1. Dönem 1. Yazılı - Senaryo 1": ["M.7.1.1.1. Tam sayılarla toplama çıkarma... (1 Soru)", "M.7.1.1.3. Çarpma bölme... (1 Soru)", "M.7.1.1.4. Üslü nicelik... (1 Soru)", "M.7.1.1.5. Problemler... (3 Soru)"],
                    "1. Dönem 1. Yazılı - Senaryo 2": ["M.7.1.1.1. Toplama çıkarma... (1 Soru)", "M.7.1.1.2. İşlem özellikleri... (1 Soru)"]
                }
            }
        };

        function loadLessons() {
            const grade = document.getElementById('selGrade').value;
            const lessonSelect = document.getElementById('selLesson');
            const scenarioSelect = document.getElementById('selScenario');
            lessonSelect.innerHTML = '<option value="">Seçiniz...</option>'; 
            scenarioSelect.innerHTML = '<option value="">Önce ders seçin</option>';
            scenarioSelect.disabled = true; 
            document.getElementById('kazanimContainer').style.display = "none";
            
            if (grade && database[grade]) {
                lessonSelect.disabled = false;
                for (let lesson in database[grade]) {
                    lessonSelect.innerHTML += `<option value="${lesson}">${lesson}</option>`;
                }
            } else {
                if(grade) { 
                    lessonSelect.disabled = false; 
                    lessonSelect.innerHTML += `<option value="Matematik">Matematik</option><option value="Türkçe">Türkçe</option><option value="Fen Bilimleri">Fen Bilimleri</option><option value="Sosyal Bilgiler">Sosyal Bilgiler</option><option value="İngilizce">İngilizce</option><option value="Din Kültürü">Din Kültürü</option>`; 
                } else { 
                    lessonSelect.disabled = true; 
                }
            }
        }

        function loadScenarios() {
            try {
                const grade = document.getElementById('selGrade').value;
                const lesson = document.getElementById('selLesson').value;
                const scenarioSelect = document.getElementById('selScenario');

                scenarioSelect.innerHTML = '<option value="">Seçiniz...</option>';
                document.getElementById('kazanimContainer').style.display = "none";
                document.getElementById('inpLesson').value = lesson ? lesson.toUpperCase() : "";
                updateHeader();

                if (grade && lesson && database[grade] && database[grade][lesson]) {
                    scenarioSelect.disabled = false;
                    for (let sc in database[grade][lesson]) {
                        scenarioSelect.innerHTML += `<option value="${sc}">${sc}</option>`;
                    }
                } else {
                    scenarioSelect.disabled = true;
                    scenarioSelect.innerHTML = '<option value="">Hazır senaryo yok</option>';
                }
            } catch (err) { console.error('loadScenarios error', err); }
        }

        function applyScenario() {
            try {
                const grade = document.getElementById('selGrade').value;
                const lesson = document.getElementById('selLesson').value;
                const scenario = document.getElementById('selScenario').value;
                const kazanimList = document.getElementById('kazanimList');

                if (grade && lesson && scenario && database[grade] && database[grade][lesson] && database[grade][lesson][scenario]) {
                    document.getElementById('kazanimContainer').style.display = "block";
                    kazanimList.innerHTML = "";
                    
                    const outcomes = database[grade][lesson][scenario];
                    outcomes.forEach(function(item) {
                        const safe = String(item).replace(/'/g, "\\'");
                        kazanimList.innerHTML += `<div class="btn-kazanim" onclick="fillKazanim('${safe}')">${item} <i class="fas fa-plus-circle"></i></div>`;
                    });
                } else {
                    document.getElementById('kazanimContainer').style.display = "none";
                }
            } catch (err) { console.error('applyScenario error', err); }
        }

        function fillKazanim(text) { document.getElementById('inpKazanim').value = text; document.getElementById('newQ').focus(); }

        let questions = [];
        function updateHeader() {
            try {
                document.getElementById('outExamNo').innerText = (document.getElementById('inpExamName').value || "1. SINAV").toUpperCase();
                document.getElementById('outLesson').innerText = (document.getElementById('inpLesson').value || "DERS ADI").toUpperCase();
                document.getElementById('outSchool').innerText = (document.getElementById('inpSchool').value || "").toUpperCase() || "OKUL ADI";
                document.getElementById('outTeacher').innerText = document.getElementById('inpTeacher').value || "...";
                document.getElementById('outTitle').innerText = document.getElementById('inpTitle').value || "Ders Öğretmeni";
            } catch (err) { console.error('updateHeader error', err); }
        }

        function addQuestion() {
            const kaz = document.getElementById('inpKazanim').value; const soru = document.getElementById('newQ').value; const pVal = document.getElementById('newP').value; const space = document.getElementById('spaceSize').value; const fileInput = document.getElementById('inpImg');
            if(!kaz && !soru && (!fileInput || fileInput.files.length===0)) { alert("Veri giriniz."); return; }
            if (fileInput && fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e){ pushQuestion(kaz, soru, pVal, space, e.target.result); };
                reader.readAsDataURL(fileInput.files[0]);
            }
            else { pushQuestion(kaz, soru, pVal, space, null); }
        }
        
        function pushQuestion(kaz, soru, pts, spc, img) {
            questions.push({ kazanım: kaz, text: soru, points: pts || "", space: spc || "100", image: img });
            document.getElementById('inpKazanim').value = ""; document.getElementById('newQ').value = ""; document.getElementById('newP').value = ""; 
            const fi = document.getElementById('inpImg'); if(fi) { try { fi.value = ""; } catch(e){ } }
            renderQuestions();
        }
        
        function deleteQuestion(index) { questions.splice(index, 1); renderQuestions(); }

        function renderQuestions() {
            const mini = document.getElementById('miniList'); const container = document.getElementById('questionsContainer');
            const layout = document.getElementById('inpLayout').value;
            mini.innerHTML = ""; container.innerHTML = "";
            let tableHTML = '<table style="width:100%; border:none;">';
            questions.forEach((q, i) => {
                mini.innerHTML += `<li class="mini-item"><span>${i+1}. Soru</span> <i class="fas fa-times btn-del" onclick="deleteQuestion(${i})"></i></li>`;
                let imgHTML = q.image ? `<img src="${q.image}" style="max-width:100%; max-height:200px; display:block; margin:10px 0;">` : '';
                let pointsHTML = q.points ? `<span style="float:right; font-weight:bold;">(${q.points} P)</span>` : '';
                let kazanimHTML = q.kazanım ? `<div class="kazanim-box">Kazanım: ${q.kazanım}</div>` : '';
                let questionContent = `<div style="margin-bottom:20px; break-inside:avoid;">${kazanimHTML}<div style="display:flex; gap:10px;"><div style="font-weight:bold; font-size:12pt; width:25px;">${i+1}.</div><div style="flex:1;"><span style="font-size:12pt; display:block; margin-bottom:5px;">${q.text} ${pointsHTML}</span>${imgHTML}<div style="height:${q.space}px; border-bottom:1px dotted #999;"></div></div></div></div>`;
                if (layout == "1") { tableHTML += `<tr><td>${questionContent}</td></tr>`; } 
                else { if (i % 2 === 0) { tableHTML += `<tr><td style="width:48%; vertical-align:top;">${questionContent}</td><td style="width:4%;"></td>`; } else { tableHTML += `<td style="width:48%; vertical-align:top;">${questionContent}</td></tr>`; } }
            });
            if (layout == "2" && questions.length % 2 !== 0) { tableHTML += "<td></td></tr>"; }
            tableHTML += "</table>";
            container.innerHTML = tableHTML;
        }

        window.addEventListener('DOMContentLoaded', function() {
            updateHeader();
            try { const g = document.getElementById('selGrade').value; if(g) loadLessons(); } catch(e){}
        });
    </script>
</body>
</html>